{"google":"","tagline":"Clock synchronized with ajax","body":"# Reloj CSS sincronizado con el servidor mediante ajax:\r\nOnline test demo version of [clock synchronized with ajax](http://eduardo.mazarrasa.tk/clock/)\r\n\r\n## El reloj con HTML y CSS:\r\n`\r\n> <body onload=\"compruebaHoraServidor();mueveReloj();\">\r\n> <div id=\"reloj\">\r\n> \t<div class=\"circulo\">\r\n> \t\t<div id=\"segundero\" class=\"segundos\"><div class=\"agujaseg\" id=\"agujaseg\"></div></div>\r\n> \t\t\r\n> \t\t<div id=\"minutero\" class=\"minutos\"><div class=\"agujamin\" id=\"agujamin\" ></div></div>\r\n> \t\t\r\n> \t\t<div id=\"horero\" class=\"hora\"><div class=\"agujahora\" id=\"agujahora\" ></div></div>\r\n> \t</div>\r\n> </div>\r\n> </body>`\r\n\r\n`\r\n> .circulo {\r\n> \t background-color: #EEE;\r\n> \t border: 3px dashed #333;\r\n> \t height: 150px;\r\n> \t border-radius:75px;\r\n> \t \r\n> \t width: 150px;\r\n> \t box-shadow:5px 5px 5px #999999;\r\n> \t position:relative;\r\n> }\r\n> .segundos{\r\n> \tbackground-color:transparent;\r\n> \tpadding: 0;\r\n> \tmargin:0;\r\n> \theight:2px;\r\n> \twidth:142px;\r\n> \ttop:73px;\r\n> \tleft:4px;\r\n> \tposition:relative;\r\n> \t-webkit-transform:rotate(90deg);\r\n> \t-moz-transform:rotate(90deg);\r\n> \t-ms-transform: rotate(90deg); \r\n> \ttransform:rotate(90deg);\r\n> \t}\r\n> .agujaseg{\r\n> background-color: #F00;\r\n> padding: 0;\r\n> \tmargin:0;\r\n> \theight:2px;\r\n> \twidth:70px;\r\n> \ttop:0px;\r\n> \tleft:0px;\r\n> \tposition:relative;\r\n> \t //box-shadow:5px 5px 5px #999999;\r\n> }\r\n> .minutos{\r\n> \tbackground-color:transparent;\r\n> \tpadding: 0;\r\n> \tmargin:0;\r\n> \theight:4px;\r\n> \twidth:110px;\r\n> \ttop:69px;\r\n> \tleft:20px;\r\n> \tposition:relative;\r\n> \t-webkit-transform:rotate(90deg);\r\n> \t-moz-transform:rotate(90deg);\r\n> \ttransform:rotate(90deg);\r\n> \t}\r\n> .agujamin{\r\n> background-color: #000;\r\n> padding: 0;\r\n> \tmargin:0;\r\n> \theight:4px;\r\n> \twidth:55px;\r\n> \ttop:0px;\r\n> \tleft:0px;\r\n> \tposition:relative;\r\n> \t //box-shadow:5px 5px 5px #999999;\r\n> }\r\n> .hora{\r\n> \tbackground-color:transparent;\r\n> \tpadding: 0;\r\n> \tmargin:0;\r\n> \theight:8px;\r\n> \twidth:80px;\r\n> \ttop:63px;\r\n> \tleft:35px;\r\n> \tposition:relative;\r\n> \t-webkit-transform:rotate(90deg);\r\n> \t-moz-transform:rotate(90deg);\r\n> \ttransform:rotate(90deg);\r\n> \t}\r\n> .agujahora{\r\n> background-color: #000;\r\n> padding: 0;\r\n> \tmargin:0;\r\n> \theight:8px;\r\n> \twidth:40px;\r\n> \ttop:0px;\r\n> \tleft:0px;\r\n> \tposition:relative;\r\n> \t //box-shadow:5px 5px 5px #999999;\r\n> }\r\n`\r\n\r\n## EL javaScript para mover el reloj:\r\n### Establece la hora del cliente\r\nEn una variable global\r\n`var horaServer = new Date();`\r\n### funcion que mueve las agujas del reloj:\r\n`\r\nfunction mueveReloj(){\r\n\t\r\n\t//mostrar la hora calculada apartir de los datos de la hora del servidor\r\n\tvar horaScliente = horaServer.getHours();\r\n\tvar minutoScliente = horaServer.getMinutes();\r\n\tvar segundoScliente = horaServer.getSeconds();\r\n\t//var milisegundo = horaServer.getMilliseconds();\r\n\tdocument.getElementById('relojservidorcliente').innerHTML = \"<p title='Partiendo del dato de la hora el servidor se continua el calculo en el cliente.'>Hora Servidor-Cliente: \"+ imprimeHora(horaScliente,minutoScliente,segundoScliente)+ \"</p>\";\r\n\t\r\n\t//calcula el angulo de desplazamineto de cada aguja del reloj\r\n\tvar posSeg = \"rotate(\"+(90 +( segundoScliente * 6 ))+\"deg)\";\r\n\tvar posMin = \"rotate(\"+(90 +( minutoScliente * 6 ))+\"deg)\";\r\n\tvar posHor = \"rotate(\"+(90 +( horaScliente * 30 ))+\"deg)\";\r\n\t\r\n\t\r\n\t//Rotar agujas para IE9, Firefox15 y Chrome23//\r\n\t/*document.getElementById('segundos').style.transform = \"rotate(0deg)\";*/\r\n\tdocument.getElementById('segundero').style.msTransform = posSeg;\r\n\tdocument.getElementById('minutero').style.msTransform = posMin;\r\n\tdocument.getElementById('horero').style.msTransform = posHor;\r\n\t\r\n\tdocument.getElementById('segundero').style.MozTransform = posSeg;\r\n\tdocument.getElementById('minutero').style.MozTransform = posMin;\r\n\tdocument.getElementById('horero').style.MozTransform = posHor;\r\n\t\r\n\tdocument.getElementById('segundero').style.webkitTransform = posSeg;\r\n\tdocument.getElementById('minutero').style.webkitTransform = posMin;\r\n\tdocument.getElementById('horero').style.webkitTransform = posHor;\r\n\t\r\n\t\r\n\t/* Incrementa cada segundo en un segundo la hora del cliente-servidor */\r\n\thoraServer.setTime(horaServer.getTime()+1000);\r\n\tsetTimeout(\"mueveReloj()\",1000)\r\n\t\r\n}`\r\n### funciones para llamar al servidor y sincronizar la hora\r\n`function compruebaHoraServidor(){\r\n\tvar myurl = 'datexml.php';\r\n\t//Evita el cacheo de la petición//\r\n\tvar miAleatorio = parseInt(Math.random()*99999999);\r\n\tvar modurl =  myurl +\"?rand=\"+miAleatorio;\r\n\thttp.open(\"GET\",modurl,true);\r\n\thttp.onreadystatechange = recargaDatos;\r\n\thttp.send(null);\r\n\t\t\r\n\t//****Extablece el intervalo en milisegundos en el que se conecta al servidor para actualizar la hora cliente-servidor.****//\r\n\tsetTimeout(\"compruebaHoraServidor()\",60000)\r\n\t}` \r\n\r\n`function recargaDatos()\r\n\t{\r\n\t\tif(http.readyState ==4)\r\n\t\t\t{\r\n\t\t\tif (http.status == 200)\r\n\t\t\t\t{\r\n\t\t\t\t/*codigo a ejecutar porque todo ha ido bien*/\r\n\t\t\t\t\r\n\t\t\t\tvar segundos = http.responseXML.getElementsByTagName(\"hora\")[0].childNodes[0].nodeValue\r\n\t\t\t\t//milisegundos desde 1970(Época Unix)\r\n\t\t\t\thoraServer.setTime(Number(segundos)*1000);\r\n\t\t\t\t//muestra la fecha de ultima sincronización con el servidor\t\t\t\t\r\n\t\t\t\tdocument.getElementById('servidor').innerHTML = \"<p>Última sincronización con el servidor: \"+ horaServer + \"</p>\";\r\n\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t//mensaje de error\r\n\t\t\t\tdocument.getElementById('servidor').innerHTML = '<p>No se encuentra el servidor <img  src=\"img/error.jpg\"></p>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\telse\r\n\t\t\t{\r\n\t\t\t\t//waiting server\r\n\t\t\tdocument.getElementById('servidor').innerHTML = '<p>Sincronizando con el servidor...<img src=\"img/wait.gif\"></p>';\r\n\t\t\t}\r\n\t\t//setTimeout(\"compruebaHoraServidor()\",10000)\r\n\t}`","note":"Don't delete this file! It's used internally to help with page regeneration.","name":"Ajax-clock"}